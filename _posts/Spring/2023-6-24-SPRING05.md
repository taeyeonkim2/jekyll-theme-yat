---
layout: post
title: SPRING PRO5
categories: SPRING
tags: [taeyeon]
---

## Persistence Layer(DataBase) 이해하기

1.Connection POOL만들기

클라이언트가 요청을 보내기 전에 미리 DB와 연동이 되어있어야겠지?

데이터베이스 연결객체를 미리 만들어서 메모리에 저장해둘 거야(Connection POOL)

사실 web.xml을 읽을 때는 servlet-context.xml보다 root-context.xml을 먼저 읽어

그니까, DB연동이 먼저 이루어지는 거지

```1=xml
<!-- The definition of the Root Spring Container shared by all Servlets and Filters -->
	<context-param>
		<param-name>contextConfigLocation</param-name>
		<param-value>/WEB-INF/spring/root-context.xml</param-value>
	</context-param>
	
	<!-- Creates the Spring Container shared by all Servlets and Filters -->
	<listener>
		<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
	</listener>
```

가장 먼저 ContextLoaderListener 클래스의 객체가 스프링 컨테이너에 로딩이 되고,

ContextLoaderListener 클래스의 객체가 root-context.xml 파일을 읽으면서 설정된 일을 할 거야

그러면 우리는 뭐를 설정할까?? 데이터베이스 연동을 위한 설정을 하자

root-context.xml에 HikariCP라는 API를 통해 커넥션 풀을 생성할거야

먼저, 우리는 HikariConfig의 객체를 생성하고, HikariDataSource의 객체를 생성해서

두 객체가 협력해서 커넥션 풀을 생성해줄 거야

```2=xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd">
	
	<!-- Root Context: defines shared resources visible to all other web components -->
	<!-- API(HikariCP) -->
	<!-- bean : 객체를 생성하는 태그 -->
	<bean id="hikariConfig" class="com.zaxxer.hikari.HikariConfig">
	<property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/>
	<property name="jdbcUrl" value="jdbc:oracle:thin:@127.0.0.1:1521:XE"/>
	<property name="username" value="hr"/>
	<property name="password" value="hr"/>
	</bean>	
	<!-- HikariDataSource(Connection POOL을 만드는 역할을 한다) -->
	<bean id="dataSource" class="com.zaxxer.hikari.HikariDataSource" destroy-method="close">
	<constructor-arg ref="hikariConfig" />
	</bean>
  
</beans>

```
이 코드는 자바가 아니라 xml코드라서 new를 사용해서 객체를 생성할 수 가없어

이 때 사용하는 방법이 bean태그야

```
<bean id="a" class="A"> 랑
A a = new A(); 는 같다고 생각하면 돼
<property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/>
name은 해당 클래스가 가지고 있는 멤버 변수이고
value에는 멤버 변수에 넣을 값을 적어주면 돼
```

우리는 4개의 property에는 우리가 연동할 데이터베이스의 정보를 넣어주면 되지

HikariConfig는 연동할 데이터베이스의 정보를 담고 있는 클래스!

실질적으로 커넥션풀을 생성해주는 클래스는 HikariDataSource야.

그러면 HikariDataSource는 연동할 데이터베이스의 정보가 필요하지?

```
<constructor-arg ref="hikariConfig" />
얘로 연동할 데이터베이스의 정보를 참조하는 거야 
```



















