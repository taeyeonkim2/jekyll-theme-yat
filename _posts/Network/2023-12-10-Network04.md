---
layout: post
title: 스위치 - STP
categories: NETWORK
tags: taeyeonkim
---

## 스패닝 트리 이해를 위한 2가지

1. 브리지 ID

- 16비트의 브리지 우선순위와 48비트의 맥 주소로 이루어진다.

- 브리지 우선순위의 범위는 0~65535인데, 디폴트 값은 중간 값인 32786으로 사용한다.

2. Path Cost

- 말 그대로 길을 가는 데 드는 비용.

- 브리지가 얼마나 가까이, 그리고 빠른 링크로 연결되어있는지 알아내기 위한 값

- IEEE 802.1D에서는 1000Mbps를 두 장비 사이의 링크 대역폭으로 나눈 값을 사용했다.

- 예를 들어 두 스위치가 10Mbps로 연결 되어 있다면? Path Cost = 100

- 근데 기가비트와 ATM이 나오면서 소숫점이 생겨버렸네?? 소수점이 싫어서 Path Cost를 그냥 정의해버렸어

- 그 중에서, 10Mbps-100 / 100Mbps-19 / 1Gbps-4 정도는 외워두자


## 스패닝 트리를 잘하려면 3가지만 기억하자

첫째, 네트워크당 하나의 루트 브리지를 갖는다.

둘째, 루트 브리지가 아닌 나머지 모든 브리지는 무조건 하나씩의 루트포트를 갖는다.

셋째, 세그먼트당 하나씩의 데지그네이티드 포트를 갖는다.

- 루트 브리지 : 하나의 브로드캐스트에 한 개의 루트 브리지를 갖는다.( 대장 브리지 )

- 루트 포트 : 루트 브리지에 가장 빨리갈 수 있는 포트

- 데지그네이티드 포트 : 스위치가 연결되어 있을 때 이 세그먼트에서 한 포트는 데지그네이티드 포트가 되어야한다.

## STP에서 힘겨루기

누가 루트 브리지가 되고, 누가 루트포트나 데지그네이티드 포트가 될지 정하기 위해서 순서가 필요하다.

1단계 : 누가 더 작은 Root BID를 가졌나

2단계 :  루트 브리지까지의 Path Cost 값은 누가 더 작은가?

3단계 : 누구의 BID가 더 낮은가?

4단계 : 누구의 포트ID가 더 낮은가?

브리지는 스패닝 트리 정보를 주고받기 위해서 특수한 프레임을 사용하는 데, 그것을 BPDU 라고 부른다.

여기에는 Root BID, Root Path Cost, Sender BID, Port ID가 실려있다.

A:32768.1111.1111.11111 B:32768.2222.2222.2222 C:32768.3333.3333.3333 일 때,

우선 B,C 스위치만 부팅 됐다고 생각해보자

B,C는 각각 BPDU에 Sender BID와 RootBID를 실어서 보낼 건데, 아직 누가 루트 브리지인지 모르잖아?

그냥 자기를 루트 브리지라고 생각하고 자신의 RootBID에 자신의 BID를 실어서 보낼거야

그리고 나서 자기들 끼리 비교해서 더 작은 BID를 갖는 애(B)를 루트브리지로 인정하는 거지

근데 이제 A도 부팅이 됐다? A는 아직 BPDU를 주고 받은 적이 없어서 루트 브리지가 누군지 몰라

그래서 자기 BID를 RootBID에 담아서 보낼 거야. 근데 자기가 제일 작네? 

그러면 이제 B,C도 RootBID에 32768.1111.1111.1111 을 실어서 보내겠지

이렇게 루트 브리지는 정해졌어 
