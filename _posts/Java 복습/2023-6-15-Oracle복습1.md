---
layout: post
title: 서브쿼리
categories: Oracle복습
---

## any, all

```sql
<>
select username, height from usertbl where height<>(select height from usertbl where username='이승기');
//이승기와 키가 같지 않은

ERROR
select username, height from usertbl where height>(select height from usertbl where username='김경호');
//서브쿼리의 결과값이 2개라 에러

>=ANY or SOME
select username, height from usertbl where height>=any (select height from usertbl where addr='경남');
//170이상 '또는' 173이상

>=ALL
select username, height from usertbl where height>=all (select height from usertbl where addr='경남'); 
//170이상 '그리고' 173이상

=ANY or =SOME or IN
select username, height from usertbl where height=any (select height from usertbl where addr='경남');
//170과 173

NOT IN or <>ALL
select username, height 
from usertbl 
where height not in (select height from usertbl where addr='경남');

=ANY 의 반대 <>ALL

=ALL 의 반대 <>ANY 

>ANY 의 반대 <=ALL
```

## 쿼리 18)
```sql
  --1. 가장 비싼 도서의 이름을 찾아서 출력
  select bookname from book where price=(select max(price) from book);
  --2. 도서를 구매한 적이 있는 고객의 이름을 검색.
  select name from customer where custid=any(select distinct custid from orders);
  select name from customer where custid in(select distinct custid from orders);
  --3. 대한출판사에서 출판한 도서를 구매한 고객의 이름을 찾아서 출력하시요.
  순서
  -1.--대한 출판사에서 출판한 도서의 bookid 추출
     select distinct bookid from book where publisher='대한출판사';
  -2.--orders에서 bookid가 3,4,12인 custid 추출
     select custid from orders where bookid in (select distinct bookid from book where publisher='대한출판사');
  -3.최종
     select name from customer where custid in 
    (select custid from orders where bookid =any 
    (select distinct bookid from book where publisher='대한출판사'));
    
  --4.출판사별로 출판사의 평균 도서 가격보다 비싼 도서를 구하시오.
      select bookname,price from book b1--별칭 부여
      where b1.price>(select avg(price) from book b2
      where b1.publisher=b2.publisher);
```

## 쿼리 19)
```sql
  --1. 평균 주문금액 이하의 주문에 대해서 주문번호와 금액을 출력하시요.
    
  --2. 각 고객의 평균 주문금액보다 큰 금액의 주문 내역에 대해서 주문번호, 고객
      번호, 금액을 출력하시요.
       select orderid, custid, saleprice from orders o1 where saleprice >(
       select avg(saleprice) from orders o2
       where o1.custid=o2.custid
      );
  --3. 대한민국에 거주하는 고객에게 판매한 도서의 총판매액을 구하시요. (IN,
      NOT IN)
```
